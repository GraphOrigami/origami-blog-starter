# Create a virtual folder called `inlined` that's a deep copy of the `markdown`
# folder, with any expressions in {{ ... }} curly braces evaluated and inlined.
# This lets individual markdown pages like markdown/index.md contain expressions
# that do useful things, like embed a list of the blog posts.
inlined = mapDeep(markdown, inline, '.md'):

# Create a virtual folder called `html` that's a deep copy of the `inlined`
# folder, with all markdown files converted to HTML fragments.
html = mapDeep(inlined, mdHtml, '.md', '.html'):

# Create a virtual folder called `templated` that's a deep copy of the `html`
# folder, with the converted HTML fragements placed inside a site-wide page
# template.

templatedPosts = map(html/posts, post.ori, '.html'):

site = meta(this):
  index.html = page.ori(html/index.html):
  about:
    index.html = page.ori(html/about/index.html):
  posts = merge(templatedPosts, meta(this)):
    index.html = page.ori(html/posts.html):
  styles.css = src/styles.css:
